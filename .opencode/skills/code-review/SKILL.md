---
name: code-review
description: コードレビュー。PRのレビューやコードの品質チェックを行う際に使用する。共通観点に加え、変更ファイルのレイヤー（frontend/backend/infra）に応じた固有の観点でレビューする。
---

# コードレビュー

PRの変更内容をレビューし、品質・安全性・保守性の観点からフィードバックする。

## 手順

### 1. 変更内容の把握

コミット単位でレビューする。まずコミット一覧を確認し、各コミットの変更を順に見る。

```bash
gh pr view <PR番号> --json commits --jq '.commits[] | "\(.oid[:7]) \(.messageHeadline)"'
gh pr diff <PR番号>
```

### 2. 共通観点でレビュー

すべての変更に対して以下を確認する。

- **型安全性** — `any`, `as`, Non-null assertion (`!`) の使用を避けているか。やむを得ない場合は理由がコメントされているか
- **依存関係の方向** — 上位レイヤーが下位レイヤーに依存しているか。循環依存がないか。`features/` 間の直接依存がないか
- **命名** — 変数・関数・ファイル名が意図を明確に表しているか
- **セキュリティ** — OWASP Top 10（XSS、SQLi、コマンドインジェクション等）に該当しないか
- **エラーハンドリング** — 異常系が適切に処理されているか、握りつぶしていないか
- **テスト** — 変更に対応するテストが追加・更新されているか
- **lint/型エラーの抑制禁止** — `// eslint-disable`, `// @ts-ignore`, `// @ts-expect-error` 等のignoreコメントは原則禁止。根本的に修正する
- **不要なコード** — デッドコード、不要なimport、コメントアウトされたコード、不要なコメントが残っていないか
- **パフォーマンス** — 明らかなN+1クエリ、不要な再計算、メモリリークの可能性がないか
- **一貫性** — 既存コードのパターン・スタイルと一貫しているか

### 3. レイヤー固有の観点でレビュー

変更ファイルのパスに応じて該当するリファレンスを読み込み、固有の観点で確認する。

| パス | リファレンス |
|------|-------------|
| `apps/frontend/` | [references/frontend.md](references/frontend.md) |
| `apps/backend/` | [references/backend.md](references/backend.md) |
| `apps/infra/` | [references/infra.md](references/infra.md) |

複数レイヤーにまたがる変更の場合は、該当するすべてのリファレンスを参照する。

### 4. フィードバック

- 指摘は具体的に、該当箇所のファイルパスと行番号を明示する
- 重要度を明記する: **must**（修正必須）/ **want**（できれば修正）/ **nit**（細かい指摘）
- 修正案を可能な限り提示する
